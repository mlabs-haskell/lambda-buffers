# Catalyst milestone 1: LambdaBuffers Conway support

## Outputs

Implementation in repository:

1. Implementing codegen for all modules (Haskell, Plutarch, PlutusTx, Rust, TypeScript, PureScript) for
   all the new [Plutus Ledger types](https://github.com/IntersectMBO/plutus/tree/master/plutus-ledger-api/src/PlutusLedgerApi/V3).
   This includes the new governance-related types, delegation types, and updated transaction types.
2. Create new golden tests for the above types, for all language modules. For instance, we will have a
   set of files consisting of known-good JSON-serialized instances, and our testsuite will check that
   our implementation outputs these serialized values upon execution as expected. Although an exhaustive
   list of tests is not possible here, there are many Plutus types updated or new in V3 our library will
   support such as Vote, Voter, TxOutRef, TxInInfo, TxCert, etc and various concrete instantiations of
   each type to test - e.g., a VoteNo Vote, a VoteYes Vote, and so on.
3. Create new roundtrip tests for Eq, Json and PlutusData type classes (where applicable) that will
   verify our type class instances serialise and deserialize without corruption, loss of information,
   etc by converting values to JSON and back, PlutusData and back, and verifying equality withstands.
4. Implement new Plutus V3 types in plutus-ledger-api-rust and plutus-ledger-api-typescript
5. Documentation explaining the updates accomplished towards LambdaBuffers Conways support

## Acceptance Criteria

1. All Plutus V3 types are implemented correctly and LambdaBuffers now supports codegen for all the
   supported language modules for these types:

   - Both the Plutus Ledger APIs and codegen configurations are implemented
     ensuring execution outputs are as intended

2. All Plutus V3 types are covered by the golden tests ensuring execution outputs are as intended

   - All languages use the same set of golden files to test against

3. All Plutus V3 have roundtrip tests for Eq, Json and PlutusData type classes (where applicable)

   - All languages have roundtrip tests (where applicable) to tests Json and PlutusData serialization

4. The output is suitable for Plutus V3 Types such as Voter, Delegatee and GovernanceActionID etc.

   - All new Plutus V3 types have been implemented in the supporting libraries

5. Documentation will cover new type support across Lambda buffer supported languages and will
   appear on [https://mlabs-haskell.github.io/lambda-buffers](https://mlabs-haskell.github.io/lambda-buffers/) in the Catalyst Milestone F13 reporting.

   - Documentation of the newly implemented Plutus V3 types were auto-generated

## Evidence of Milestone Completion

- Proof of Achievement 1: Codegen implementation will be added to the github.com/mlabs-haskell/lambda-buffers repository and a link will be provided.
  - Codegen configuration files for all languager are augmented with the new Plutus V3 types, pointing the opaque types to their respective type declarations in libraries.
    Users of the LambdaBuffers library can now use V3 types in their schemas, and generate code for all the supported languages:
    - Haskell (with Haskell Prelude) PlutusTx codegen config: [lambda-buffers-codegen/data/haskell-plutus-plutustx.json](https://github.com/mlabs-haskell/lambda-buffers/tree/v2.0.0/lambda-buffers-codegen/data/haskell-plutus-plutustx.json)
    - Plutarch codegen config: [lambda-buffers-codegen/data/plutarch-plutus.json](https://github.com/mlabs-haskell/lambda-buffers/tree/v2.0.0/lambda-buffers-codegen/data/plutarch-plutus.json)
    - PlutusTx (with Plutus Prelude) codegen config: [lambda-buffers-codegen/data/plutustx-plutus.json](https://github.com/mlabs-haskell/lambda-buffers/tree/v2.0.0/lambda-buffers-codegen/data/plutustx-plutus.json)
    - Rust codegen config: [lambda-buffers-codegen/data/rust-plutus-pla.json](https://github.com/mlabs-haskell/lambda-buffers/tree/v2.0.0/lambda-buffers-codegen/data/rust-plutus-pla.json)
    - TypeScript codegen config: [lambda-buffers-codegen/data/typescript-plutus.json](https://github.com/mlabs-haskell/lambda-buffers/tree/v2.0.0/lambda-buffers-codegen/data/typescript-plutus.json)
    - PureScript CTL codegen config: [lambda-buffers-codegen/data/purescript-plutus-ctl.json](https://github.com/mlabs-haskell/lambda-buffers/tree/v2.0.0/lambda-buffers-codegen/data/purescript-plutus-ctl.json)
      (some types are not supported by CTL itself, so naturally these are marked as NotImplemented in the configuration file)
- Proof of Achievement 2: Rust plutus-ledger-api types and golden tests will be implemented in
  [https://github.com/mlabs-haskell/plutus-ledger-api-rust](https://github.com/mlabs-haskell/plutus-ledger-api-rust) and a link will be provided.
  - Golden tests for added types can be found here:
    - Haskell: Golden files are generated by this module and all the other language modules are reading these. All data types have golden files for Json and PlutusData serialisation. Added data types:
      PlutusV3.TxOutRef, PlutusV3.ColdCommitteeCredential, PlutusV3.HotCommitteeCredential, PlutusV3.DRepCredential, PlutusV3.DRep, PlutusV3.Delegatee, PlutusV1.Lovelace, PlutusV3.TxCert, PlutusV3.Voter,
      PlutusV3.Vote, PlutusV3.GovernanceActionId, PlutusV3.Committee, PlutusV3.Constitution, PlutusV3.ProtocolVersion, PlutusV3.ChangedParameters, PlutusV3.GovernanceAction, PlutusV3.ProposalProcedure,
      PlutusV3.ScriptPurpose, PlutusV3.ScriptInfo, PlutusV3.TxInInfo, PlutusV3.TxInfo, PlutusV3.ScriptContext
      - Golden data: [testsuites/lbt-plutus/lbt-plutus-haskell/src/Test/LambdaBuffers/Plutus/Golden.hs](https://github.com/mlabs-haskell/lambda-buffers/tree/v2.0.0/testsuites/lbt-plutus/lbt-plutus-haskell/src/Test/LambdaBuffers/Plutus/Golden.hs)
      - PlutusData tests: [testsuites/lbt-plutus/lbt-plutus-haskell/test/Test/LambdaBuffers/Runtime/Plutus/PlutusData.hs](https://github.com/mlabs-haskell/lambda-buffers/tree/v2.0.0/testsuites/lbt-plutus/lbt-plutus-haskell/test/Test/LambdaBuffers/Runtime/Plutus/PlutusData.hs)
      - Json tests: [testsuites/lbt-plutus/lbt-plutus-haskell/test/Test/LambdaBuffers/Runtime/Plutus/Json.hs](https://github.com/mlabs-haskell/lambda-buffers/tree/v2.0.0/testsuites/lbt-plutus/lbt-plutus-haskell/test/Test/LambdaBuffers/Runtime/Plutus/Json.hs)
      - [CI test logs](ci-logs/szpr3fx8yk3bpl76yrc7gxndx24w97i3-lbt-plutus-haskell-test-tests-0.1.0.0-check.drv.log)
    - Plutarch: Files are read, deserialised to Plutarch and serialised back again to verify correctness. Only PlutusData serialisation is tested as Plutarch doesn't handle Json.
      - PlutusData tests: [testsuites/lbt-plutus/lbt-plutus-plutarch/test/Test/LambdaBuffers/Runtime/Plutarch/PlutusData.hs](https://github.com/mlabs-haskell/lambda-buffers/tree/v2.0.0/testsuites/lbt-plutus/lbt-plutus-plutarch/test/Test/LambdaBuffers/Runtime/Plutarch/PlutusData.hs)
      - [CI test logs](ci-logs/4n52lchdrnkmc73l10mgvv9j04ykkq9v-lbt-plutus-plutarch-test-tests-0.1.0.0-check.drv.log)
    - PlutusTx: Files are read, deserialised to PlutusData and applied to Plutus Scripts. In these Plutus Scripts, we also do roundtrip tests, deserialising and serialising the data to ensure compatibility.
      Only PlutusData serialisation is tested as PlutusTx doesn't handle Json.
      - Plutus Scripts: [testsuites/lbt-plutus/lbt-plutus-plutustx/test/Test/LambdaBuffers/Runtime/PlutusTx/PlutusTx.hs](https://github.com/mlabs-haskell/lambda-buffers/tree/v2.0.0/testsuites/lbt-plutus/lbt-plutus-plutustx/test/Test/LambdaBuffers/Runtime/PlutusTx/PlutusTx.hs)
      - PlutusData tests: [testsuites/lbt-plutus/lbt-plutus-plutustx/test/Test/LambdaBuffers/Runtime/PlutusTx/PlutusData.hs](https://github.com/mlabs-haskell/lambda-buffers/tree/v2.0.0/testsuites/lbt-plutus/lbt-plutus-plutustx/test/Test/LambdaBuffers/Runtime/PlutusTx/PlutusData.hs)
      - [CI test logs](ci-logs/crnl10qhhrzw8hixzgjs7w6z5ckwy28j-lbt-plutus-plutustx-test-tests-0.1.0.0-check.drv.log)
    - Rust: Equivalent Rust golden data is implemented and compared with the ones generated by the Haskell module. Both Json and PlutusData serialisations are tested.
      - Golden data: [testsuites/lbt-plutus/lbt-plutus-rust/tests/goldens.rs](https://github.com/mlabs-haskell/lambda-buffers/tree/v2.0.0/testsuites/lbt-plutus/lbt-plutus-rust/tests/goldens.rs)
      - PlutusData and Json tests: [testsuites/lbt-plutus/lbt-plutus-rust/tests/main.rs](https://github.com/mlabs-haskell/lambda-buffers/tree/v2.0.0/testsuites/lbt-plutus/lbt-plutus-rust/tests/main.rs)
      - [CI test logs](ci-logs/lvrm5lf8rzlg06sahbd9j4sdh7axa99j-lbt-plutus-nextest-0.1.0.drv.log)
    - TypeScript: Equivalent TypesScript golden data is implemented and compared with the ones generated by the Haskell module. Both Json and PlutusData serialisations are tested.
      - Golden data: [testsuites/lbt-plutus/lbt-plutus-typescript/src/Goldens.ts](https://github.com/mlabs-haskell/lambda-buffers/tree/v2.0.0/testsuites/lbt-plutus/lbt-plutus-typescript/src/Goldens.ts)
      - PlutusData tests: [testsuites/lbt-plutus/lbt-plutus-typescript/src/PlutusData-test.ts](https://github.com/mlabs-haskell/lambda-buffers/tree/v2.0.0/testsuites/lbt-plutus/lbt-plutus-typescript/src/PlutusData-test.ts)
      - Json tests: [testsuites/lbt-plutus/lbt-plutus-typescript/src/Json-test.ts](https://github.com/mlabs-haskell/lambda-buffers/tree/v2.0.0/testsuites/lbt-plutus/lbt-plutus-typescript/src/Json-test.ts)
      - [CI test logs](ci-logs/xi4npf8jnag34a7kmblg8ilgmidvsqa9-lbt-plutus-typescript.drv.log)
- Proof of Achievement 3: Plutus V3 roundtrip tests located at [https://github.com/mlabs-haskell/lambda-buffers](https://github.com/mlabs-haskell/lambda-buffers) repo and a link will be provided.
  - Roundtrip tests were implemented and can be found here:
    - Haskell
      - PlutusData: [https://github.com/mlabs-haskell/lambda-buffers/tree/v2.0.0/testsuites/lbt-plutus/lbt-plutus-haskell/test/Test/LambdaBuffers/Runtime/Plutus/PlutusData.hs](https://github.com/mlabs-haskell/lambda-buffers/tree/v2.0.0/testsuites/lbt-plutus/lbt-plutus-haskell/test/Test/LambdaBuffers/Runtime/Plutus/PlutusData.hs)
      - Json: [https://github.com/mlabs-haskell/lambda-buffers/tree/v2.0.0/testsuites/lbt-plutus/lbt-plutus-haskell/test/Test/LambdaBuffers/Runtime/Plutus/Json.hs](https://github.com/mlabs-haskell/lambda-buffers/tree/v2.0.0/testsuites/lbt-plutus/lbt-plutus-haskell/test/Test/LambdaBuffers/Runtime/Plutus/Json.hs)
    - Plutarch: [testsuites/lbt-plutus/lbt-plutus-plutarch/test/Test/LambdaBuffers/Runtime/Plutarch/PlutusData.hs](https://github.com/mlabs-haskell/lambda-buffers/tree/v2.0.0/testsuites/lbt-plutus/lbt-plutus-plutarch/test/Test/LambdaBuffers/Runtime/Plutarch/PlutusData.hs)
    - PlutusTx: [testsuites/lbt-plutus/lbt-plutus-plutustx/test/Test/LambdaBuffers/Runtime/PlutusTx/PlutusTx.hs](https://github.com/mlabs-haskell/lambda-buffers/tree/v2.0.0/testsuites/lbt-plutus/lbt-plutus-plutustx/test/Test/LambdaBuffers/Runtime/PlutusTx/PlutusTx.hs)
    - Rust
      - PlutusData and Json: [testsuites/lbt-plutus/lbt-plutus-rust/tests/main.rs](https://github.com/mlabs-haskell/lambda-buffers/tree/v2.0.0/testsuites/lbt-plutus/lbt-plutus-rust/tests/main.rs)
      - Property based tests for PlutusData: [https://github.com/mlabs-haskell/plutus-ledger-api-rust/blob/v3.0.2/plutus-ledger-api/tests/plutus_data.rs](https://github.com/mlabs-haskell/plutus-ledger-api-rust/blob/v3.0.2/plutus-ledger-api/tests/plutus_data.rs)
      - Property based tests for Json: [https://github.com/mlabs-haskell/plutus-ledger-api-rust/blob/v3.0.2/plutus-ledger-api/tests/lbf.rs](https://github.com/mlabs-haskell/plutus-ledger-api-rust/blob/v3.0.2/plutus-ledger-api/tests/lbf.rs)
    - TypeScript
      - PlutusData: [testsuites/lbt-plutus/lbt-plutus-typescript/src/PlutusData-test.ts](https://github.com/mlabs-haskell/lambda-buffers/tree/v2.0.0/testsuites/lbt-plutus/lbt-plutus-typescript/src/PlutusData-test.ts)
      - Json: [testsuites/lbt-plutus/lbt-plutus-typescript/src/Json-test.ts](https://github.com/mlabs-haskell/lambda-buffers/tree/v2.0.0/testsuites/lbt-plutus/lbt-plutus-typescript/src/Json-test.ts)
      - Property based tests for PlutusData and Json: [https://github.com/mlabs-haskell/plutus-ledger-api-typescript/blob/v1.2.1/src/Tests/V3](https://github.com/mlabs-haskell/plutus-ledger-api-typescript/blob/v3.2.1/src/Tests/V3)
- Proof of Achievement 4: Plutus V3 types located at [https://github.com/mlabs-haskell/plutus-ledger-api-rust](https://github.com/mlabs-haskell/plutus-ledger-api-rust)
  [https://github.com/mlabs-haskell/plutus-ledger-api-typescript](https://github.com/mlabs-haskell/plutus-ledger-api-typescript) and links provided.
  - Plutus_Ledger API Rust implementation was implemented here: [mlabs-haskell/plutus-ledger-api-rust v3.0.2](https://github.com/mlabs-haskell/plutus-ledger-api-rust/tree/v3.0.2/plutus-ledger-api/src/v3)
  - Plutus_Ledger API TypeScript implementation was implemented here: [mlabs-haskell/plutus-ledger-api-typescript v1.2.1](https://github.com/mlabs-haskell/plutus-ledger-api-typescript/tree/v1.2.1/src/Lib/V3)
- Proof of Achievement 5: Page addressing the new Documentation on types for Catalyst Fund 13 at [https://mlabs-haskell.github.io/lambda-buffers](https://mlabs-haskell.github.io/lambda-buffers)
  - Documentation of plutus-ledger-api-rust V3 types is located here: [https://mlabs-haskell.github.io/plutus-ledger-api-rust/plutus_ledger_api/v3](https://mlabs-haskell.github.io/plutus-ledger-api-rust/plutus_ledger_api/v3)
  - Documentation of plutus-ledger-api-typescript V3 types is located here: [https://mlabs-haskell.github.io/plutus-ledger-api-typescript/modules/plutus_ledger_api_V3_js](https://mlabs-haskell.github.io/plutus-ledger-api-typescript/modules/plutus_ledger_api_V3_js.html)
  - Conway compatibility report [docs/catalyst13-reports/milestone-1.md](https://github.com/mlabs-haskell/lambda-buffers/tree/v2.0.0/docs/catalyst13-reports/milestone-1.md)
  - Updated [lambda-buffers-for-cardano](https://github.com/mlabs-haskell/lambda-buffers-for-cardano) repository and documentation
  - Updated [Changelog](https://github.com/mlabs-haskell/lambda-buffers/tree/v2.0.0/CHANGELOG.md)
