<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>LambdaBuffers Frontend (.lbf) syntax - Lambda Buffers documentation</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><li class="part-title">User Guide</li><li class="chapter-item expanded "><a href="introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="using-lambdabuffers.html"><strong aria-hidden="true">2.</strong> Using LambdaBuffers</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="haskell.html"><strong aria-hidden="true">2.1.</strong> LambdaBuffers to Haskell</a></li><li class="chapter-item expanded "><a href="purescript.html"><strong aria-hidden="true">2.2.</strong> LambdaBuffers to Purescript</a></li><li class="chapter-item expanded "><a href="plutarch.html"><strong aria-hidden="true">2.3.</strong> LambdaBuffers to Plutarch</a></li><li class="chapter-item expanded "><a href="rust.html"><strong aria-hidden="true">2.4.</strong> LambdaBuffers to Rust</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">Reference Guide</li><li class="chapter-item expanded "><a href="getting-started.html"><strong aria-hidden="true">3.</strong> Getting started</a></li><li class="chapter-item expanded "><a href="design.html"><strong aria-hidden="true">4.</strong> Design</a></li><li class="chapter-item expanded "><a href="api.html"><strong aria-hidden="true">5.</strong> API</a></li><li class="chapter-item expanded "><a href="syntax.html" class="active"><strong aria-hidden="true">6.</strong> LambdaBuffers Frontend (.lbf) syntax</a></li><li class="chapter-item expanded "><a href="compiler.html"><strong aria-hidden="true">7.</strong> Compiler</a></li><li class="chapter-item expanded "><a href="codegen.html"><strong aria-hidden="true">8.</strong> Codegen</a></li><li class="chapter-item expanded "><a href="command-line-interface.html"><strong aria-hidden="true">9.</strong> Command line interface</a></li><li class="chapter-item expanded "><a href="comparison-matrix.html"><strong aria-hidden="true">10.</strong> Comparison matrix</a></li><li class="chapter-item expanded "><a href="catalyst-reports.html"><strong aria-hidden="true">11.</strong> Catalyst reports</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="catalyst09-reports/index.html"><strong aria-hidden="true">11.1.</strong> Catalyst 9 reports</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="catalyst09-reports/milestone-1.html"><strong aria-hidden="true">11.1.1.</strong> Milestone 1: Research</a></li><li class="chapter-item expanded "><a href="catalyst09-reports/milestone-2.html"><strong aria-hidden="true">11.1.2.</strong> Milestone 2: End to end proof of concept</a></li><li class="chapter-item expanded "><a href="catalyst09-reports/milestone-3.html"><strong aria-hidden="true">11.1.3.</strong> Milestone 3: Testing and documentation</a></li><li class="chapter-item expanded "><a href="catalyst09-reports/milestone-3.html"><strong aria-hidden="true">11.1.4.</strong> Milestone 4: Project adoption</a></li></ol></li><li class="chapter-item expanded "><a href="catalyst10-reports/index.html"><strong aria-hidden="true">11.2.</strong> Catalyst 10 reports</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="catalyst10-reports/milestone-1.html"><strong aria-hidden="true">11.2.1.</strong> Milestone 1: Rust support</a></li></ol></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Lambda Buffers documentation</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="lambdabuffers-frontend-lbf-syntax"><a class="header" href="#lambdabuffers-frontend-lbf-syntax">LambdaBuffers Frontend (.lbf) syntax</a></h1>
<p>The input to the LambdaBuffers Frontend is a text file which contains a module that defines a specification of the types and type class instances you want to generate. This chapter gives the exact syntax of a LambdaBuffers Frontend file, and informally describes meaning of the syntactic constructs.</p>
<p>The name of a LambdaBuffers Frontend file must end with <code>.lbf</code>, and hence may also be referred to as a .lbf file or a .lbf schema.</p>
<h2 id="notation"><a class="header" href="#notation">Notation</a></h2>
<p>In the following description of a LambdaBuffers Frontend file's syntax, we use a similar BNF syntax from <a href="https://www.haskell.org/onlinereport/haskell2010/">Section 10.1 of the Haskell Report</a>. So, the following notational conventions are used for presenting syntax.</p>
<div class="table-wrapper"><table><thead><tr><th>Syntax</th><th>Description</th></tr></thead><tbody>
<tr><td><code>[pattern]</code></td><td>optional</td></tr>
<tr><td><code>{pattern}</code></td><td>zero or more repetitions</td></tr>
<tr><td><code>(pattern)</code></td><td>grouping</td></tr>
<tr><td><code>pat1âŽ®pat2</code></td><td>choice</td></tr>
<tr><td><code>pat1\pat2</code></td><td>difference -- elements generated by <code>pat1</code> except those generated by <code>pat2</code></td></tr>
<tr><td><code>'terminal'</code></td><td>terminal syntax surrounded by single quotes</td></tr>
</tbody></table>
</div><!-- Apparently, `mdbook`'s markdown can't escape the vertical bar in codeblocks in a table....
     So, we're using code point U+23AE to look like a vertical bar when it really isn't...

| `pat1|pat2`  | choice                                                                      | 
-->
<p>Note that the terminal syntax permits C-style escape sequences e.g. <code>'\n'</code> denotes line feed (newline), and <code>'\r'</code> denotes carriage return.</p>
<p>Productions will be of the form:</p>
<pre><code class="language-text">nonterm -&gt; alt1 | ... | altn
</code></pre>
<h2 id="input-file-representation"><a class="header" href="#input-file-representation">Input file representation</a></h2>
<p>The input file is Unicode text where the encoding is subject to the system locale. We will often use the unqualified term <em>character</em> to refer to a Unicode code point in the input file.</p>
<h2 id="characters"><a class="header" href="#characters">Characters</a></h2>
<p>The following terms are used to denote specific Unicode character categories:</p>
<ul>
<li>
<p><code>upper</code> denotes a Unicode code point categorized as an uppercase letter or titlecase letter (i.e., with General Category value Lt or Lu).</p>
</li>
<li>
<p><code>lower</code> denotes a Unicode code point categorized as a lower-case letter (i.e., with General Category value Ll).</p>
</li>
<li>
<p><code>alphanum</code> denotes either <code>upper</code> or <code>lower</code>; or a Unicode code point categorized as a modifier letter, other letter, decimal digit number, letter number, or other number (i.e., with General Category value Lt, Lu, Ll, Lm, Lo, Nd, Nl or No).</p>
</li>
<li>
<p><code>space</code> denotes a Unicode code point categorized as a separator space (i.e., with General Category value Zs), or any of the control characters <code>'\t'</code>, <code>'\n'</code>, <code>'\r'</code>, <code>'\f'</code>, or <code>'\v'</code>.</p>
</li>
</ul>
<p>Interested readers may find details of Unicode character categories in <a href="https://www.unicode.org/versions/Unicode15.1.0/">Section 4.5 of The Unicode Standard 15.1.0</a>, and the <a href="https://unicode.org/ucd/">Unicode Character Database</a>.</p>
<h2 id="lexical-syntax"><a class="header" href="#lexical-syntax">Lexical syntax</a></h2>
<p>Tokens form the vocabulary of LambdaBuffers Frontend files. The classes of tokens are defined as follows.</p>
<pre><code class="language-text">keyword         -&gt; 'module' | 'sum' | 'prod' | 'record'
                 | 'opaque' | 'class' | 'instance' | 'import' 
                 | 'qualified' | 'as'
modulename      -&gt; uppercamelcase
longmodulename  -&gt; modulealias modulename
typename        -&gt; uppercamelcase
fieldname       -&gt; lowercamelcase\keyword
longtypename    -&gt; modulealias typename
varname         -&gt; lowers\keyword
punctuation     -&gt; '&lt;=' | ',' | '(' | ')' | '{' | '}' 
                 | ':' | ':-' | '=' | '|'
classname       -&gt; uppercamelcase
longclassname   -&gt; modulealias uppercamelcase
</code></pre>
<p>where</p>
<pre><code class="language-text">uppercamelcase -&gt; upper { alphanum }
lowercamelcase -&gt; lower { alphanum }
modulealias    -&gt; { uppercamelcase '.' }
lowers         -&gt; lower { lower }
</code></pre>
<p>Input files are broken into <em>tokens</em> which use the <em>maximal munch</em> rule i.e., at each point, the next token is the longest sequence of characters that form a valid token. <code>space</code>s or line comments are ignored except as it separates tokens that would otherwise combine into a single token.</p>
<h3 id="line-comments"><a class="header" href="#line-comments">Line comments</a></h3>
<p>A <em>line comment</em> starts with the terminal <code>'--'</code> followed by zero or more printable Unicode characters stopping at the first end of line (<code>'\n'</code> or <code>'\r\n'</code>).</p>
<h2 id="syntax-of-lambdabuffers-frontend-files"><a class="header" href="#syntax-of-lambdabuffers-frontend-files">Syntax of LambdaBuffers Frontend files</a></h2>
<p>A LambdaBuffers Frontend file defines a module that is a collection of data types, classes, instance clauses, and derive clauses.</p>
<p>The overall layout of a LambdaBuffers Frontend file is:</p>
<pre><code class="language-text">module -&gt; 'module' longmodulename { import } { statement }
</code></pre>
<p>The file must specify the module's <code>longmodulename</code> where its <code>modulename</code> must match the LambdaBuffers Frontend file's file name not including the <code>.lbf</code> extension.
After, the file may contain a sequence of <code>import</code>s followed by a sequence of <code>statement</code>s.</p>
<h3 id="import"><a class="header" href="#import">Import</a></h3>
<p>Imports bring <em>entities</em> (types and classes) of other modules into scope.</p>
<pre><code class="language-text">import     -&gt; 'import' [ 'qualified' ] longmodulename [ 'as' longmodulename ] [ importspec ]
importspec -&gt; '(' [ { typename ',' } typename [','] ] ')'
</code></pre>
<p>If <code>importspec</code> is omitted, then all entities specified in the module are imported; otherwise only the specified entities are imported.</p>
<h3 id="statement"><a class="header" href="#statement">Statement</a></h3>
<p>Statements define types, classes, instance clauses, and derive clauses.</p>
<pre><code class="language-text">statement -&gt; typedef
           | classdef
           | instanceclause
           | deriveclause
</code></pre>
<h4 id="type-definitions"><a class="header" href="#type-definitions">Type definitions</a></h4>
<p>Types may be either sum types, product types, record types, or opaque types.</p>
<pre><code class="language-text">typedef -&gt; prodtypedef | sumtypedef |  recordtypedef | opaquetypedef
</code></pre>
<h5 id="product-type-definition"><a class="header" href="#product-type-definition">Product type definition</a></h5>
<p>A product type definition defines a new product type.</p>
<pre><code class="language-text">prodtypedef -&gt; 'prod' typename { varname } '=' prod
prod        -&gt; { typeexp }
typeexp     -&gt; varname
             | longtypename
             | '(' prod ')'
</code></pre>
<p>Product type definitions instruct the code generator to generate a product type for the target language.</p>
<h5 id="sum-type-definition"><a class="header" href="#sum-type-definition">Sum type definition</a></h5>
<p>A sum type definition defines a new sum type.</p>
<pre><code class="language-text">sumtypedef     -&gt; 'sum' typename { varname } '=' sum
sum            -&gt; sumconstructor { '|' sumconstructor }
sumconstructor -&gt; typename prod
</code></pre>
<p>Sum type definitions instruct the code generator to generate a sum type for the target language.</p>
<h5 id="record-type-definition"><a class="header" href="#record-type-definition">Record type definition</a></h5>
<p>A record type definition defines a new record type.</p>
<pre><code class="language-text">recordtypedef -&gt; 'record' typename { varname } '=' record
record        -&gt; '{' [ field { ',' field  } ] '}'
field         -&gt; fieldname ':' prod
</code></pre>
<p>Record type definitions instruct the code generator to generate a record type for the target language.</p>
<h5 id="opaque-type-definition"><a class="header" href="#opaque-type-definition">Opaque type definition</a></h5>
<p>An opaque type definition defines a new opaque type.</p>
<pre><code class="language-text">opaquetypedef -&gt; 'opaque' typename { varname }
</code></pre>
<p>Opaque type definitions must map to existing types in the target language and it's up to the Codegen module to determine how that's exactly done.</p>
<h4 id="class-definition"><a class="header" href="#class-definition">Class definition</a></h4>
<p>A class definition introduces a new class.</p>
<pre><code class="language-text">classdef       -&gt; 'class' [ constraintexps '&lt;=' ] classname { varname }
constraintexp  -&gt; classref { varname }
                | '(' constraintexps ')'
constraintexps -&gt; [ constraintexp { ',' constraintexp } ]
</code></pre>
<p>Class definitions communicate with the code generator the implementations that already exist (via instance clauses) or that one would like to generate (via derive clauses).</p>
<h4 id="instance-clause"><a class="header" href="#instance-clause">Instance clause</a></h4>
<p>An instance clause specifies a type is an instance of a class.</p>
<pre><code class="language-text">instanceclause -&gt; 'instance'  constraint [ ':-' constraintexps ]
constraint     -&gt; classref { typeexp }
</code></pre>
<p>Instance clauses do not instruct the code generator to generate code, but instead instructs the compiler (semantic checking) that the target language environment provides type class implementations for the given type (provided that the given <code>constraintexps</code> also have implementations).</p>
<h4 id="derive-clause"><a class="header" href="#derive-clause">Derive clause</a></h4>
<p>Derive clauses instruct the code generator to generate code for a type so that it is an instance of a class.</p>
<pre><code class="language-text">deriveclause -&gt; 'derive' constraint
</code></pre>
<p>Note the code generation of a type for a class is implemented via builtin derivation rules (which developers may extend).</p>
<h3 id="syntax-reference"><a class="header" href="#syntax-reference">Syntax reference</a></h3>
<p>The summarized productions of a LambdaBuffers Frontend file is as follows.</p>
<pre><code class="language-text">module -&gt; 'module' longmodulename { import } { statement }

import     -&gt; 'import' [ 'qualified' ] longmodulename [ 'as' longmodulename ] [ importspec ]
importspec -&gt; '(' [ { typename ',' } typename [','] ] ')'

statement -&gt; typedef
           | classdef
           | instanceclause
           | deriveclause

typedef -&gt; prodtypedef | sumtypedef |  recordtypedef | opaquetypedef

prodtypedef -&gt; 'prod' typename { varname } '=' prod
prod        -&gt; { typeexp }
typeexp     -&gt; varname
             | longtypename
             | '(' prod ')'

sumtypedef     -&gt; 'sum' typename { varname } '=' sum
sum            -&gt; sumconstructor { '|' sumconstructor }
sumconstructor -&gt; typename prod

recordtypedef -&gt; 'record' typename { varname } '=' record
record        -&gt; '{' [ field { ',' field  } ] '}'
field         -&gt; fieldname ':' prod

opaquetypedef -&gt; 'opaque' typename { varname }

classdef       -&gt; 'class' [ constraintexps '&lt;=' ] classname { varname }
constraintexp  -&gt; classref { varname }
                | '(' constraintexps ')'
constraintexps -&gt; [ constraintexp { ',' constraintexp } ]

instanceclause -&gt; 'instance'  constraint [ ':-' constraintexps ]
constraint     -&gt; classref { typeexp }

deriveclause -&gt; 'derive' constraint
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="api.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="compiler.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="api.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="compiler.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
